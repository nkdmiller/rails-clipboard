
<div class="home-box">
	<button class="button-green" id="ne">Next Project</button>
	<h1><%=@project.name%></h1>
	<p id="test">hi</p>
		<%= render partial: "projects/table", locals: {delete_privelage: true} %>
	<h3><a href='/projects/<%="#{@project.id}"%>/tasks/new'><button class='button-green'>Add Task</button></a></h3><br>
	<h3><a data-confirm="You sure you want to delete this project?" rel="nofollow" data-method="delete" href='/projects/<%="#{@project.id}"%>'><button class='button-red'>Delete Project</button></a></h3>
</div>

<p id="loc">hi</p>
<button id='load-tasks' hidden onclick="loadTasks()">Show Tasks</button>
<p val=[] id="x"></p>


<script>
	let current_id
	$.get("/users/getcurrentuser", function( data ) {
		current_id = data["id"]	
		$("#load-tasks").show()
	})					
	function loadTasks() {
		$("#load-tasks").hide()
		let results = []
		$("#headers").show()
		var arr = window.location.toString().split('/')
		var project_id = arr[arr.length - 1]
		$.get( "/projects/" + project_id + ".json", function( data ) {
			data["tasks"].forEach(function(el) {
			  results.push(el)
			})
			var i = 0

			for (i = 0; i < results.length; i++){

				if (results[i]["admin"] != true){
					$("#task-table").append("<%= j render partial: 'projects/task' %>");
					$(".taskName").last().text(results[i]["role"])
					console.log(current_id)
					if (results[i]["user_id"] != current_id && results[i]["filled"] === true){
						$(".creator").last().text(username)
						$(".actionButton").last().text("N/A")
					}
					else if (results[i]["user_id"] == current_id && results[i]["filled"] === true){
						$(".creator").last().text("You!")
						$(".actionButton").last().append("<h3><button class='button-red'>Drop Task</button></h3>")
					}
					else{
						$(".creator").last().text("Empty!")
						$(".actionButton").last().append("<h3><button class='button-green'>Pick Up Task</button></h3>")
					}
					if (current_id === results[0]["user_id"]){
						$(".delete").last().append("<h3><button class='button-red'>Delete</button></h3>")
					}
				}
			}
		});		
	}
</script>
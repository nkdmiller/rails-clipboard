
<div class="home-box">
	<button class="button-green" id="ne">Next Project</button>
	<h1><%=@project.name%></h1>
	<p id="test">hi</p>
		<%= render partial: "projects/table", locals: {delete_privelage: true} %>
	<h3><a href='/projects/<%="#{@project.id}"%>/tasks/new'><button class='button-green'>Add Task</button></a></h3><br>
	<h3><a data-confirm="You sure you want to delete this project?" rel="nofollow" data-method="delete" href='/projects/<%="#{@project.id}"%>'><button class='button-red'>Delete Project</button></a></h3>
</div>

<p id="loc">hi</p>
<button id='load-tasks' onclick="loadTasks()">Show Tasks</button>
<p val=[] id="x"></p>


<script>
	function loadTasks() {
		$("#load-tasks").hide()
		let results = []
		$("#headers").show()
		var arr = window.location.toString().split('/')
		var project_id = arr[arr.length - 1]
		$.get( "/projects/" + project_id + ".json", function( data ) {
			data["tasks"].forEach(function(el) {
			  results.push(el)
			})
			var i = 0
			for (i = 0; i < results.length; i++){
				if (results[i]["admin"] != true){
					$("#task-table").append("<%= j render partial: 'projects/task' %>");
					console.log(results[i])
					$(".taskName").last().text(results[i]["role"])
					var user_id =""
					var username =""
					var current_id =""
					$.get( "/users/" + results[i]["user_id"] + ".json", function( data ) {
						console.log(data)
						user_id = data["id"]
						username = data["name"]
					})
					$.get("/users/getcurrentuser", function( data ) {
						console.log(data)
						current_id = data["id"]	
					})
					if (results[i]["user_id"] != current_id && results[i]["filled"] === true){
						$(".creator").last().text(username)
					
					}
					else if (results[i]["user_id"] == current_id && results[i]["filled"] === true){
						$(".creator").last().text("You!")
					}
					else{
						$(".creator").last().text("Empty!")
					}
				}
			}
		});		
	}
</script>
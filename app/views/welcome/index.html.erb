<div class="home-box">
	<h1><button onclick="loadMyTasks()" class='button-green' class = 'loads-current-user' id = 'my-tasks'>My Tasks!</button></h1>
	<%= render partial: "projects/table", locals: {delete_privelage: true} %>
</div>
<div class="home-box">
	<h1>My Projects!</h1>
		<%@projects.each do |proj|%>
			<h3><a href='/projects/<%="#{proj.id}"%>'><button class='button-green' id = 'all-projects'><%="#{proj.name}"%></button></a></h3>
		<%end%>
</div>
<div class="home-box" id= "all-projects-box">
	<h1><button onclick="loadAllProjects()" class='button-green' class = 'loads-current-user' id = 'my-tasks'>Current Projects!</button></h1>

</div>

<script>
	$( document ).ready(function() {
		if (current_id == true){
			$(".loads-current-user").show()
		}
	});		
	function loadMyTasks() {
		$("#headers").show()
		$.get( "/tasks/index.json", function( data ) {
			console.log(data)
			var i = 0
			for (i = 0; i < data.length; i++){
				console.log(data[i])
				if (data[i]["admin"] != true){
					var task = {}
					task = new Task(data[i]["filled"], data[i]["admin"], data[i]["username"], data[i]["user_id"], data[i]["role"], data[i]["project_id"], data[i]["id"])
					$("#task-table").append("<%= j render partial: 'projects/task' %>");
					task.setInformation()
					if (current_id === data[0]["user_id"]){
						$(".delete").last().append("<h3><button class='button-red'>Delete</button></h3>")
					}
					else {
						$(".delete").last().append("N/A")
					}
				}
			}
		$("#my-tasks").prop("disabled",true);
		})
	}
	function loadAllProjects() {
		$.get( "/projects.json", function( data ) {
			console.log(data)
			var i = 0
			for (i = 0; i < data.length; i++){
				$("#all-projects-box").append("<button id='loads-current' class='loads-current-user' hidden onclick="+loadProjectTasks(new Project(data[i]["name"], data[i]["created_at"],data[i]["id"]), i)+">"+ data[i]["name"] +"</button>")
				$("#all-projects-box").append("<table id = 'task-table' style='width:30%'><tr class='headers' id =" + i + " hidden><th>Task</th><th>User</th> <th>Action</th></tr></table>")
			}
			$("#my-tasks").prop("disabled",true);		
		})
	}
	function loadProjectTasks(project, i){
		$.get( "/projects/" + project.id + ".json", function( data ) {
			let results = []
			data["tasks"].forEach(function(el) {
			  results.push(el)
			})
			var i = 0
			for (i = 0; i < results.length; i++){
				if (results[i]["admin"] != true){
					var task = {}
					task = new Task(results[i]["filled"], results[i]["admin"], results[i]["username"], results[i]["user_id"], results[i]["role"], results[i]["project_id"], results[i]["id"])
					$("#task-table").append("<%= j render partial: 'projects/task' %>");
					task.setInformation()
					if (current_id === results[0]["user_id"]){
						$(".delete").last().append("<h3><button class='button-red'>Delete</button></h3>")
					}
					else {
						$(".delete").last().append("N/A")
					}
				}
			}
		});				
	}
</script>